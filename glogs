#!/bin/bash
# uses goaccess to summarize nginx logs
# glogs html is run every hour with:
# 0 */1 * * * /home/sean/vps/glogs html

# once a user is in /etc/nginx/blacklist.conf
# dont show it in the glogs file
cd /var/log/nginx

case "$1" in
status)
  [ -z "$2" ] && echo "specify HTTP status as second argument" && exit 1
  awk -v field=$2 '$9 == field {print}' access.log
  ;;
raw)
	# just print the logs
		cat access.log
	;;
recent)
	# goaccess terminal recent logs
	tail -f -n +1 access.log | goaccess --log-format=COMBINED -
	;;
all)
	# goaccess terminal all logs
	tail -f -n +1 access.log | goaccess --log-format=COMBINED -
	;;
html)
	goaccess --log-format=COMBINED -o "${HOME}/.goaccess_html/banned.html" access.log
  echo
	;;
*)
	echo "Must specify 'recent', 'all', 'raw', or 'html' as argument"
	exit 1
	;;
esac
